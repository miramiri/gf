import asyncio
from datetime import datetime
from telethon import events
from telethon.tl.functions.account import UpdateProfileRequest

# ğŸ”¢ ØªÙ…Ø§Ù… ÙÙˆÙ†Øªâ€ŒÙ‡Ø§
DIGITS = {
    1: "ğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿",
    2: "ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡",
    3: "â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨",
    4: "â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨",
    5: "â“¿â¶â·â¸â¹âºâ»â¼â½â¾",
    6: "ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«",
    7: "ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµ",
    8: "ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—",
    9: "ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™",
    10: "â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰",
    11: "â°Â¹Â²Â³â´âµâ¶â·â¸â¹",
    12: "â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨",
    13: "ğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿",
    14: "0Ò‰1Ò‰2Ò‰3Ò‰4Ò‰5Ò‰6Ò‰7Ò‰8Ò‰9Ò‰",
    15: "0â€Œ1â€Œ2â€Œ3â€Œ4â€Œ5â€Œ6â€Œ7â€Œ8â€Œ9",
    16: "0â€‹1â€‹2â€‹3â€‹4â€‹5â€‹6â€‹7â€‹8â€‹9",
    17: "0â€1â€2â€3â€4â€5â€6â€7â€8â€9",
    18: "â™¥0â™¥1â™¥2â™¥3â™¥4â™¥5â™¥6â™¥7â™¥8â™¥9",
    19: "â‰‹0â‰‹1â‰‹2â‰‹3â‰‹4â‰‹5â‰‹6â‰‹7â‰‹8â‰‹9",
    20: "â–‘0â–‘1â–‘2â–‘3â–‘4â–‘5â–‘6â–‘7â–‘8â–‘9",
    21: "âŠ¶0âŠ¶1âŠ¶2âŠ¶3âŠ¶4âŠ¶5âŠ¶6âŠ¶7âŠ¶8âŠ¶9",
    22: "âŠ°0âŠ±1âŠ°2âŠ±3âŠ°4âŠ±5âŠ°6âŠ±7âŠ°8âŠ±9",
    23: "â¦…0â¦†1â¦…2â¦†3â¦…4â¦†5â¦…6â¦†7â¦…8â¦†9",
    24: "â¦‘0â¦’1â¦‘2â¦’3â¦‘4â¦’5â¦‘6â¦’7â¦‘8â¦’9",
    25: "â§¼0â§½1â§¼2â§½3â§¼4â§½5â§¼6â§½7â§¼8â§½9",
    26: "â¨€0â¨€1â¨€2â¨€3â¨€4â¨€5â¨€6â¨€7â¨€8â¨€9",
    27: "â¨Œ0â¨Œ1â¨Œ2â¨Œ3â¨Œ4â¨Œ5â¨Œ6â¨Œ7â¨Œ8â¨Œ9",
    28: "â©´0â©´1â©´2â©´3â©´4â©´5â©´6â©´7â©´8â©´9",
    29: "âª‰0âª‰1âª‰2âª‰3âª‰4âª‰5âª‰6âª‰7âª‰8âª‰9",
    30: "â«¶0â«¶1â«¶2â«¶3â«¶4â«¶5â«¶6â«¶7â«¶8â«¶9",
    31: "â¬˜0â¬˜1â¬˜2â¬˜3â¬˜4â¬˜5â¬˜6â¬˜7â¬˜8â¬˜9",
    32: "â¬š0â¬š1â¬š2â¬š3â¬š4â¬š5â¬š6â¬š7â¬š8â¬š9",
    33: "â¬¦0â¬¦1â¬¦2â¬¦3â¬¦4â¬¦5â¬¦6â¬¦7â¬¦8â¬¦9",
    34: "â¬§0â¬§1â¬§2â¬§3â¬§4â¬§5â¬§6â¬§7â¬§8â¬§9",
    35: "â¬¨0â¬¨1â¬¨2â¬¨3â¬¨4â¬¨5â¬¨6â¬¨7â¬¨8â¬¨9",
    36: "â•š0â•1â•š2â•3â•š4â•5â•š6â•7â•š8â•9",
    37: "â• 0â•£1â• 2â•£3â• 4â•£5â• 6â•£7â• 8â•£9",
    38: "ã€0ã€ã€1ã€ã€2ã€ã€3ã€ã€4ã€ã€5ã€ã€6ã€ã€7ã€ã€8ã€ã€9ã€",
    39: "ã€0ã€‘ã€1ã€‘ã€2ã€‘ã€3ã€‘ã€4ã€‘ã€5ã€‘ã€6ã€‘ã€7ã€‘ã€8ã€‘ã€9ã€‘",
    40: "ã€–0ã€—1ã€–2ã€—3ã€–4ã€—5ã€–6ã€—7ã€–8ã€—9",
    41: "ã€˜0ã€™1ã€˜2ã€™3ã€˜4ã€™5ã€˜6ã€™7ã€˜8ã€™9",
    42: "ã€š0ã€›1ã€š2ã€›3ã€š4ã€›5ã€š6ã€›7ã€š8ã€›9",
    43: "ã€0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9",
    44: "ã€Ÿ0ã€Ÿ1ã€Ÿ2ã€Ÿ3ã€Ÿ4ã€Ÿ5ã€Ÿ6ã€Ÿ7ã€Ÿ8ã€Ÿ9",
    45: "ï¹…0ï¹†1ï¹…2ï¹†3ï¹…4ï¹†5ï¹…6ï¹†7ï¹…8ï¹†9",
    46: "ï¹‰0ï¹Š1ï¹‰2ï¹Š3ï¹‰4ï¹Š5ï¹‰6ï¹Š7ï¹‰8ï¹Š9",
    47: "ï¹‹0ï¹Œ1ï¹‹2ï¹Œ3ï¹‹4ï¹Œ5ï¹‹6ï¹Œ7ï¹‹8ï¹Œ9",
    48: "ï¹0ï¹1ï¹2ï¹3ï¹4ï¹5ï¹6ï¹7ï¹8ï¹9",
    49: "ï¹0ï¹‘1ï¹2ï¹‘3ï¹4ï¹‘5ï¹6ï¹‘7ï¹8ï¹‘9",
    50: "ï¹”0ï¹•1ï¹”2ï¹•3ï¹”4ï¹•5ï¹”6ï¹•7ï¹”8ï¹•9",
    51: "ï¹–0ï¹—1ï¹–2ï¹—3ï¹–4ï¹—5ï¹–6ï¹—7ï¹–8ï¹—9",
    52: "ï¹™0ï¹š1ï¹™2ï¹š3ï¹™4ï¹š5ï¹™6ï¹š7ï¹™8ï¹š9",
}

# ğŸ›  ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„
def convert_time(time_str, font_id):
    digits = DIGITS.get(font_id, DIGITS[1])
    normal_digits = "0123456789"
    trans_table = str.maketrans(normal_digits, digits[:10])
    return time_str.translate(trans_table)


def register_clock(client, state, save_state):

    async def update_lastname():
        while True:
            if state.get("clock_on", False):
                try:
                    now = datetime.now().strftime("%H:%M")
                    font_id = state.get("clock_font", 1)
                    formatted = convert_time(now, font_id)

                    me = await client.get_me()
                    await client(UpdateProfileRequest(
                        first_name=me.first_name or "",
                        last_name=formatted
                    ))
                    print(f"â° Ø³Ø§Ø¹Øª Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯: {formatted}")
                except Exception as e:
                    print("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ø¯ÛŒØª Ø³Ø§Ø¹Øª:", e)
            await asyncio.sleep(60)

    client.loop.create_task(update_lastname())

    # Ø±ÙˆØ´Ù† / Ø®Ø§Ù…ÙˆØ´
    @client.on(events.NewMessage(pattern=r"\.Ø³Ø§Ø¹Øª (Ø±ÙˆØ´Ù†|Ø®Ø§Ù…ÙˆØ´)$"))
    async def toggle_clock(event):
        if event.sender_id != state["owner_id"]:
            return
        arg = event.pattern_match.group(1)
        state["clock_on"] = (arg == "Ø±ÙˆØ´Ù†")
        save_state()
        await event.edit(f"â° Ø³Ø§Ø¹Øª {'ÙØ¹Ø§Ù„' if state['clock_on'] else 'ØºÛŒØ±ÙØ¹Ø§Ù„'} Ø´Ø¯.")

    # ØªØºÛŒÛŒØ± ÙÙˆÙ†Øª
    @client.on(events.NewMessage(pattern=r"\.Ø³Ø§Ø¹Øª ÙÙˆÙ†Øª (\d+)$"))
    async def set_font(event):
        if event.sender_id != state["owner_id"]:
            return
        num = int(event.pattern_match.group(1))
        if num in DIGITS:
            state["clock_font"] = num
            save_state()
            await event.edit(f"ğŸ”¤ ÙÙˆÙ†Øª Ø³Ø§Ø¹Øª Ø±ÙˆÛŒ {num} ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.")
        else:
            await event.edit("âŒ Ø§ÛŒÙ† ÙÙˆÙ†Øª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ù‡ (Û± ØªØ§ ÛµÛ²).")

    # Ù„ÛŒØ³Øª Ø³Ø§Ø¹Øª
    @client.on(events.NewMessage(pattern=r"\.Ù„ÛŒØ³Øª Ø³Ø§Ø¹Øª$"))
    async def clock_list(event):
        if event.sender_id != state["owner_id"]:
            return
        msg = """Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±llÄ±Ä±llÄ±
ğŸ•°ï¸ Ø³Ø§Ø¹Øª 
â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ§ .Ø³Ø§Ø¹Øª â¤³ (Ø±ÙˆØ´Ù† ÛŒØ§ Ø®Ø§Ù…ÙˆØ´)

ğŸ”„ ÙˆØ¶Ø¹ÛŒØª Ø³Ø§Ø¹Øª
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
âœ§ .Ø³Ø§Ø¹Øª ÙÙˆÙ†Øª â¤³ (1 ... 52)

ğŸ”¤ ØªÙ†Ø¸ÛŒÙ… ÙÙˆÙ†Øª
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
â€”â€”â€”â€”â€”fontsâ€”â€”â€”â€”â€”
""" + "\n".join([f"{i}- {convert_time('00:00', i)}" for i in range(1, 53)])
        await event.edit(msg)
